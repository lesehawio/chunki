<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Chunk Cycle Pro</title>
<link rel="icon" type="image/png" href="https://uploadkon.ir/uploads/855814_261000016643-removebg-preview.png">

<style>
/* ================= ROOT THEMES ================= */
:root{
  --green:#91c300;
  --red:#ff4b5c;
  --dark-bg:#050711;
  --dark-card:#111522;
  --dark-gray:#2d334a;
  --light-bg:#f5f5f5;
  --light-card:#ffffff;
  --light-gray:#e0e0e0;
  --text-dark:#ffffff;
  --text-light:#000000;
  --shadow:rgba(0,0,0,0.55);
}

*{
  box-sizing:border-box;
  font-family:'Segoe UI',sans-serif;
}

body.dark{
  background:radial-gradient(circle at top,#1b2540,#050711);
  color:var(--text-dark);
}
body.light{
  background:radial-gradient(circle at top,#ffffff,#dcdcdc);
  color:var(--text-light);
}

body{
  margin:0;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  padding:20px;
  transition:background 0.5s ease, color 0.5s ease;
}

/* ================= TOP BAR ================= */
.top-bar{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:90px;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding-top:10px;
  z-index:20;
}

/* Ø¯Ú©Ù…Ù‡Ù” ØªÙ… Ø¯Ø± Ú¯ÙˆØ´Ù‡Ù” Ø¨Ø§Ù„Ø§ Ø³Ù…Øª Ú†Ù¾ */
.theme-btn{
  position:absolute;
  left:15px;
  top:15px;
  width:42px;
  height:42px;
  border:none;
  border-radius:50%;
  cursor:pointer;
  font-size:20px;
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(6px);
  color:#fff;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  transition:0.3s;
}
body.light .theme-btn{
  background:rgba(0,0,0,0.15);
  color:#000;
}
.theme-btn:hover{
  transform:scale(1.12);
}

/* ================= LOGO ================= */
.logo{
  position:absolute;
  top:15px;          /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø¨Ø§Ù„Ø§ */
  right:15px;        /* ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø±Ø§Ø³Øª */
  cursor:pointer;
  z-index:30;
}
.logo img{
  width:130px;
  filter:drop-shadow(0 10px 26px rgba(0,255,118,0.55));
  animation:float 3.5s ease-in-out infinite;
  transition:transform 0.35s ease, filter 0.35s ease;
}
.logo img:hover{
  transform:translateY(-6px) scale(1.06);
  filter:drop-shadow(0 14px 32px rgba(0,255,118,0.85));
}
.logo img:active{
  transform:scale(0.9);
}
@keyframes float{
  0%{transform:translateY(0);}
  50%{transform:translateY(-8px);}
  100%{transform:translateY(0);}
}

/* ================= CONTAINER ================= */
.container{
  width:100%;
  max-width:520px;
  background:var(--dark-card);
  border-radius:22px;
  padding:110px 30px 30px 30px; /* ÙØ¶Ø§ÛŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ù„ÙˆÚ¯ÙˆÛŒ Ø¨Ø§Ù„Ø§ØªØ± */
  box-shadow:0 18px 45px var(--shadow);
  position:relative;
  overflow:hidden;
  transition:background 0.5s ease, box-shadow 0.5s ease, transform 0.3s ease;
}
body.light .container{
  background:var(--light-card);
}
.container:hover{
  transform:translateY(-3px);
}

/* ================= UI ================= */
h2{
  text-align:center;
  margin-bottom:8px;
  font-weight:650;
}

.progress-container{
  width:100%;
  height:10px;
  background:rgba(255,255,255,0.08);
  border-radius:999px;
  overflow:hidden;
  margin-bottom:15px;
}
.progress-bar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#91c300,#00ffb3);
  transition:width 0.4s ease;
}

.stage{
  text-align:center;
  opacity:.8;
  margin-bottom:12px;
  font-size:14px;
}

.word{
  text-align:center;
  font-size:26px;
  letter-spacing:3px;
  margin:12px 0;
  color:var(--green);
  text-shadow:0 0 10px rgba(0,255,118,0.6);
}

/* ================= ANSWER & LETTERS ================= */
.answer-box{
  min-height:60px;
  border:2px dashed rgba(255,255,255,0.12);
  border-radius:16px;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin:18px 0;
  padding:12px;
  background:rgba(0,0,0,0.25);
  backdrop-filter:blur(10px);
}
body.light .answer-box{
  border-color:rgba(0,0,0,0.12);
  background:rgba(255,255,255,0.6);
}

.letters{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:12px;
  margin-bottom:12px;
}

.letter{
  background:var(--dark-gray);
  padding:12px 16px;
  border-radius:14px;
  cursor:pointer;
  user-select:none;
  transition:all 0.25s ease;
  font-size:18px;
  box-shadow:0 4px 14px rgba(0,0,0,0.4);
}
body.light .letter{
  background:var(--light-gray);
}
.letter:hover{
  transform:scale(1.12) translateY(-2px);
  background:var(--green);
  color:#000;
}

/* ================= NEXT BUTTON ================= */
.next-btn{
  width:100%;
  margin-top:12px;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  background:#444;
  color:#aaa;
  cursor:not-allowed;
  transition:0.3s;
}
.next-btn.active{
  background:linear-gradient(90deg,#91c300,#00ffb3);
  color:#000;
  cursor:pointer;
}

/* ================= RESULT MODAL ================= */
.result-overlay{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,0.45);
  backdrop-filter:blur(4px);
  opacity:0;
  pointer-events:none;
  transition:opacity 0.3s ease;
  z-index:50;
}
.result-overlay.show{
  opacity:1;
  pointer-events:auto;
}

.result-card{
  width:90%;
  max-width:360px;
  border-radius:20px;
  padding:22px;
  background:rgba(15,18,30,0.92);
  color:#fff;
  box-shadow:0 18px 40px rgba(0,0,0,0.7);
  transform:scale(0.85) translateY(20px);
  opacity:0;
  transition:transform 0.35s ease, opacity 0.35s ease;
}
body.light .result-card{
  background:rgba(255,255,255,0.96);
  color:#000;
}
.result-overlay.show .result-card{
  transform:scale(1) translateY(0);
  opacity:1;
}

.result-icon{
  font-size:40px;
  text-align:center;
  margin-bottom:10px;
}
.result-title{
  text-align:center;
  font-weight:700;
  margin-bottom:10px;
}
.result-detail{
  font-size:15px;
  line-height:1.7;
  margin-top:6px;
  text-align:center;
}
.result-score{
  margin-top:10px;
  font-size:15px;
  font-weight:600;
  text-align:center;
  color:var(--green);
}

.modal-next{
  margin-top:18px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:linear-gradient(90deg,#91c300,#00ffb3);
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  color:#000;
}

/* ================= RESPONSIVE ================= */
@media(max-width:500px){
  .container{padding:120px 20px 25px 20px;}
  .word{font-size:22px;}
  .letter{padding:10px 14px;font-size:16px;}
}
</style>
</head>

<body class="dark">

<!-- TOP BAR -->
<div class="top-bar">
  <button class="theme-btn" id="themeBtn">ğŸŒ™</button>

  <div class="logo" id="logoToggle">
    <img src="https://uploadkon.ir/uploads/855814_261000016643-removebg-preview.png">
  </div>
</div>

<div class="container">

  <h2>English Learning Game</h2>

  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div class="stage" id="stage"></div>
  <div class="word" id="targetWord"></div>

  <div class="answer-box" id="answerBox"></div>
  <div class="letters" id="lettersBox"></div>

  <button class="next-btn" id="nextBtn">Continue</button>

  <div class="info" id="info"></div>
  <div class="score">Score: <span id="score">0</span></div>

</div>

<!-- RESULT MODAL -->
<div class="result-overlay" id="resultOverlay">
  <div class="result-card">
    <div class="result-icon" id="resultIcon">âŒ</div>
    <div class="result-title" id="resultTitle">Ù†ØªÛŒØ¬Ù‡</div>
    <div class="result-detail" id="resultDetail"></div>
    <div class="result-score" id="resultScore"></div>
    <button class="modal-next" id="modalNext">Next</button>
  </div>
</div>

<script>
/* ================= DATA ================= */
const data = {
  stages:["noun","verb","chunk"],
  score:{ noun:2, verb:2, chunk:4 },
pairs:[
 
  {
    noun: {w: "notes", fa: "ÛŒØ§Ø¯Ø¯Ø§Ø´Øª", pr: "Ù†ÙˆØªØ³"},
    verb: {w: "take", fa: "Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù†", pr: "ØªÙÛŒÚ©"},
    chunk: "take notes",
    chunkFa: "ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø¨Ø±Ø¯Ø§Ø´ØªÙ†"
  },
  {
    noun: {w: "class", fa: "Ú©Ù„Ø§Ø³", pr: "Ú©Ù„Ø§Ø³"},
    verb: {w: "attend", fa: "Ø­Ø§Ø¶Ø± Ø´Ø¯Ù†", pr: "Ø§ÙØªÙÙ†Ø¯"},
    chunk: "attend class",
    chunkFa: "Ø¯Ø± Ú©Ù„Ø§Ø³ Ø­Ø§Ø¶Ø± Ø´Ø¯Ù†"
  },
  {
    noun: {w: "assignment", fa: "ØªÚ©Ù„ÛŒÙ", pr: "Ø§ÙØ³Ø§ÛŒÙ†Ù…Ù†Øª"},
    verb: {w: "submit", fa: "ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù†", pr: "Ø³Ø§Ø¨Ù…ÛŒØª"},
    chunk: "submit assignment",
    chunkFa: "ØªØ­ÙˆÛŒÙ„ ØªÚ©Ù„ÛŒÙ Ø¯Ø§Ø¯Ù†"
  },
  {
    noun: {w: "exam", fa: "Ø§Ù…ØªØ­Ø§Ù†", pr: "Ø§ÙÚ¯Ø²Ù…"},
    verb: {w: "pass", fa: "Ù‚Ø¨ÙˆÙ„ Ø´Ø¯Ù†", pr: "Ù¾Ø§Ø³"},
    chunk: "pass exam",
    chunkFa: "Ù‚Ø¨ÙˆÙ„ Ø´Ø¯Ù† Ø¯Ø± Ø§Ù…ØªØ­Ø§Ù†"
  },
  {
    noun: {w: "exam", fa: "Ø§Ù…ØªØ­Ø§Ù†", pr: "Ø§ÙÚ¯Ø²Ù…"},
    verb: {w: "fail", fa: "Ø±Ø¯ Ø´Ø¯Ù†", pr: "ÙÙÛŒÙ„"},
    chunk: "fail exam",
    chunkFa: "Ø±Ø¯ Ø´Ø¯Ù† Ø¯Ø± Ø§Ù…ØªØ­Ø§Ù†"
  },
  {
    noun: {w: "homework", fa: "ØªÚ©Ù„ÛŒÙ", pr: "Ù‡ÙˆÙ…ÙˆØ±Ú©"},
    verb: {w: "do", fa: "Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù†", pr: "Ø¯Ùˆ"},
    chunk: "do homework",
    chunkFa: "Ø§Ù†Ø¬Ø§Ù… ØªÚ©Ø§Ù„ÛŒÙ"
  },
  {
    noun: {w: "presentation", fa: "Ù¾Ø±Ø²Ù†ØªÛŒØ´Ù†", pr: "Ù¾Ø±ÛŒØ²Ù†ØªÛŒØ´Ù†"},
    verb: {w: "prepare", fa: "Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ø±Ø¯Ù†", pr: "Ù¾Ø±ÛŒÙ¾ÛŒØ±"},
    chunk: "prepare presentation",
    chunkFa: "Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ø±Ø¯Ù† Ù¾Ø±Ø²Ù†ØªÛŒØ´Ù†"
  },
  {
    noun: {w: "lecture", fa: "Ø¯Ø±Ø³", pr: "Ù„Ú©Ú†Ø±"},
    verb: {w: "give", fa: "Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ø§Ø¯Ù†", pr: "Ú¯ÛŒÙˆ"},
    chunk: "give lecture",
    chunkFa: "Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ø±Ø³ Ø¯Ø§Ø¯Ù†"
  },
  {
    noun: {w: "meeting", fa: "Ø¬Ù„Ø³Ù‡", pr: "Ù…ÛŒØªÛŒÙ†Ú¯"},
    verb: {w: "schedule", fa: "Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ú©Ø±Ø¯Ù†", pr: "Ø§Ø³Ú©Ø¬ÙˆÙ„"},
    chunk: "schedule meeting",
    chunkFa: "Ø¬Ù„Ø³Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ú©Ø±Ø¯Ù†"
  },
  {
    noun: {w: "workshop", fa: "Ú©Ø§Ø±Ú¯Ø§Ù‡", pr: "ÙˆØ±Ú©Ø´Ø§Ù¾"},
    verb: {w: "organize", fa: "Ø¨Ø±Ú¯Ø²Ø§Ø± Ú©Ø±Ø¯Ù†", pr: "Ø§ÙˆØ±Ú¯Ù†Ø§ÛŒØ²"},
    chunk: "organize workshop",
    chunkFa: "Ú©Ø§Ø±Ú¯Ø§Ù‡ Ø¨Ø±Ú¯Ø²Ø§Ø± Ú©Ø±Ø¯Ù†"
  },
  {
    noun: {w: "report", fa: "Ú¯Ø²Ø§Ø±Ø´", pr: "Ø±Ù¾ÙˆØ±Øª"},
    verb: {w: "write", fa: "Ù†ÙˆØ´ØªÙ†", pr: "Ø±Ø§ÛŒØª"},
    chunk: "write report",
    chunkFa: "Ú¯Ø²Ø§Ø±Ø´ Ù†ÙˆØ´ØªÙ†"
  },
  {
    noun: {w: "book", fa: "Ú©ØªØ§Ø¨", pr: "Ø¨ÙˆÚ©"},
    verb: {w: "read", fa: "Ø®ÙˆØ§Ù†Ø¯Ù†", pr: "Ø±ÛŒØ¯"},
    chunk: "read book",
    chunkFa: "Ú©ØªØ§Ø¨ Ø®ÙˆØ§Ù†Ø¯Ù†"
  },
  {
    noun: {w: "notes", fa: "ÛŒØ§Ø¯Ø¯Ø§Ø´Øª", pr: "Ù†ÙˆØªØ³"},
    verb: {w: "review", fa: "Ù…Ø±ÙˆØ± Ú©Ø±Ø¯Ù†", pr: "Ø±ÛŒÙˆÛŒÙˆ"},
    chunk: "review notes",
    chunkFa: "Ù…Ø±ÙˆØ± ÛŒØ§Ø¯Ø¯Ø§Ø´Øªâ€ŒÙ‡Ø§"
  },
  {
    noun: {w: "test", fa: "ØªØ³Øª", pr: "ØªØ³Øª"},
    verb: {w: "take", fa: "Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù†", pr: "ØªÙÛŒÚ©"},
    chunk: "take test",
    chunkFa: "ØªØ³Øª Ø¯Ø§Ø¯Ù†"
  },
  {
    noun: {w: "seminar", fa: "Ø³Ù…ÛŒÙ†Ø§Ø±", pr: "Ø³Ù…ÛŒÙ†Ø§Ø±"},
    verb: {w: "attend", fa: "Ø­Ø§Ø¶Ø± Ø´Ø¯Ù†", pr: "Ø§ÙØªÙÙ†Ø¯"},
    chunk: "attend seminar",
    chunkFa: "Ø¯Ø± Ø³Ù…ÛŒÙ†Ø§Ø± Ø´Ø±Ú©Øª Ú©Ø±Ø¯Ù†"
  },
  {
    noun: {w: "project", fa: "Ù¾Ø±ÙˆÚ˜Ù‡", pr: "Ù¾Ø±Ø§Ø¬Ú©Øª"},
    verb: {w: "complete", fa: "ØªÚ©Ù…ÛŒÙ„ Ú©Ø±Ø¯Ù†", pr: "Ú©Ø§Ù…Ù¾Ù„ÛŒØª"},
    chunk: "complete project",
    chunkFa: "ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÚ˜Ù‡"
  },
  {
    noun: {w: "question", fa: "Ø³ÙˆØ§Ù„", pr: "Ú©ÙˆØ¦Ø³Ú†Ù†"},
    verb: {w: "ask", fa: "Ù¾Ø±Ø³ÛŒØ¯Ù†", pr: "Ø§Ø³Ú©"},
    chunk: "ask question",
    chunkFa: "Ø³ÙˆØ§Ù„ Ù¾Ø±Ø³ÛŒØ¯Ù†"
  },
  {
    noun: {w: "question", fa: "Ø³ÙˆØ§Ù„", pr: "Ú©ÙˆØ¦Ø³Ú†Ù†"},
    verb: {w: "answer", fa: "Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù†", pr: "Ø§Ù†Ø³Ø±"},
    chunk: "answer question",
    chunkFa: "Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù†"
  },
  {
    noun: {w: "subject", fa: "Ø¯Ø±Ø³", pr: "Ø³Ø§Ø¨Ø¬Ú©Øª"},
    verb: {w: "study", fa: "Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ø±Ø¯Ù†", pr: "Ø§Ø³ØªØ§Ø¯ÛŒ"},
    chunk: "study subject",
    chunkFa: "Ù…Ø·Ø§Ù„Ø¹Ù‡ ÛŒÚ© Ø¯Ø±Ø³"
  },
  {
    noun: {w: "problem", fa: "Ù…Ø´Ú©Ù„", pr: "Ù¾Ø±Ø§Ø¨Ù„Ù…"},
    verb: {w: "solve", fa: "Ø­Ù„ Ú©Ø±Ø¯Ù†", pr: "Ø³Ø§Ù„Ùˆ"},
    chunk: "solve problem",
    chunkFa: "Ø­Ù„ Ú©Ø±Ø¯Ù† Ù…Ø´Ú©Ù„"
  },
  {
    noun: {w: "class", fa: "Ú©Ù„Ø§Ø³", pr: "Ú©Ù„Ø§Ø³"},
    verb: {w: "join", fa: "Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù†", pr: "Ø¬ÙˆÛŒÙ†"},
    chunk: "join class",
    chunkFa: "Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ú©Ù„Ø§Ø³"
  },
  {
    noun: {w: "course", fa: "Ø¯ÙˆØ±Ù‡", pr: "Ú©ÙˆØ±Ø³"},
    verb: {w: "enroll", fa: "Ù†Ø§Ù…â€ŒÙ†ÙˆÛŒØ³ÛŒ Ú©Ø±Ø¯Ù†", pr: "Ø§Ù†Ø±ÙˆÙ„"},
    chunk: "enroll in course",
    chunkFa: "Ù†Ø§Ù…â€ŒÙ†ÙˆÛŒØ³ÛŒ Ø¯Ø± Ø¯ÙˆØ±Ù‡"
  },
  {
    noun: {w: "exam", fa: "Ø§Ù…ØªØ­Ø§Ù†", pr: "Ø§ÙÚ¯Ø²Ù…"},
    verb: {w: "prepare", fa: "Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù†", pr: "Ù¾Ø±ÛŒÙ¾ÛŒØ±"},
    chunk: "prepare for exam",
    chunkFa: "Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù† Ø¨Ø±Ø§ÛŒ Ø§Ù…ØªØ­Ø§Ù†"
  },
  {
    noun: {w: "exam", fa: "Ø§Ù…ØªØ­Ø§Ù†", pr: "Ø§ÙÚ¯Ø²Ù…"},
    verb: {w: "take", fa: "Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù†", pr: "ØªÙÛŒÚ©"},
    chunk: "take exam",
    chunkFa: "Ø§Ù…ØªØ­Ø§Ù† Ø¯Ø§Ø¯Ù†"
  },
  {
    noun: {w: "discussion", fa: "Ø¨Ø­Ø«", pr: "Ø¯ÛŒØ³Ú©Ø§Ø´Ù†"},
    verb: {w: "participate", fa: "Ø´Ø±Ú©Øª Ú©Ø±Ø¯Ù†", pr: "Ù¾Ø§Ø±ØªÛŒØ³ÛŒÙ¾ÛŒØª"},
    chunk: "participate in discussion",
    chunkFa: "Ø´Ø±Ú©Øª Ø¯Ø± Ø¨Ø­Ø«"
  },
  {
    noun: {w: "team", fa: "ØªÛŒÙ…", pr: "ØªÛŒÙ…"},
    verb: {w: "lead", fa: "Ù‡Ø¯Ø§ÛŒØª Ú©Ø±Ø¯Ù†", pr: "Ù„ÛŒØ¯"},
    chunk: "lead team",
    chunkFa: "Ù‡Ø¯Ø§ÛŒØª ØªÛŒÙ…"
  },
  {
    noun: {w: "lecture", fa: "Ø³Ø®Ù†Ø±Ø§Ù†ÛŒ", pr: "Ù„Ú©Ú†Ø±"},
    verb: {w: "attend", fa: "Ø­Ø§Ø¶Ø± Ø´Ø¯Ù†", pr: "Ø§ÙØªÙÙ†Ø¯"},
    chunk: "attend lecture",
    chunkFa: "Ø­Ø¶ÙˆØ± Ø¯Ø± Ø³Ø®Ù†Ø±Ø§Ù†ÛŒ"
  },
  {
    noun: {w: "idea", fa: "Ø§ÛŒØ¯Ù‡", pr: "Ø¢ÛŒØ¯ÛŒØ§"},
    verb: {w: "present", fa: "Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ø§Ø¯Ù†", pr: "Ù¾Ø±ÛŒØ²Ù†Øª"},
    chunk: "present idea",
    chunkFa: "Ø§Ø±Ø§Ø¦Ù‡ Ø§ÛŒØ¯Ù‡"
  },
  {
    noun: {w: "report", fa: "Ú¯Ø²Ø§Ø±Ø´", pr: "Ø±Ù¾ÙˆØ±Øª"},
    verb: {w: "submit", fa: "ØªØ­ÙˆÛŒÙ„ Ø¯Ø§Ø¯Ù†", pr: "Ø³Ø§Ø¨Ù…ÛŒØª"},
    chunk: "submit report",
    chunkFa: "ØªØ­ÙˆÛŒÙ„ Ú¯Ø²Ø§Ø±Ø´"
  },
  {
    noun: {w: "experience", fa: "ØªØ¬Ø±Ø¨Ù‡", pr: "Ø§Ú©Ø³Ù¾ÛŒØ±ÛŒÙ†Ø³"},
    verb: {w: "gain", fa: "Ú©Ø³Ø¨ Ú©Ø±Ø¯Ù†", pr: "Ú¯ÛŒÙ†"},
    chunk: "gain experience",
    chunkFa: "ØªØ¬Ø±Ø¨Ù‡ Ú©Ø³Ø¨ Ú©Ø±Ø¯Ù†"
  },
  {
    noun: {w: "skill", fa: "Ù…Ù‡Ø§Ø±Øª", pr: "Ø§Ø³Ú©ÛŒÙ„"},
    verb: {w: "learn", fa: "ÛŒØ§Ø¯ Ú¯Ø±ÙØªÙ†", pr: "Ù„Ø±Ù†"},
    chunk: "learn skill",
    chunkFa: "Ù…Ù‡Ø§Ø±Øª ÛŒØ§Ø¯ Ú¯Ø±ÙØªÙ†"
  },
  {
    noun: {w: "class", fa: "Ú©Ù„Ø§Ø³", pr: "Ú©Ù„Ø§Ø³"},
    verb: {w: "teach", fa: "ØªØ¯Ø±ÛŒØ³ Ú©Ø±Ø¯Ù†", pr: "ØªÛŒÚ†"},
    chunk: "teach class",
    chunkFa: "ØªØ¯Ø±ÛŒØ³ Ú©Ø±Ø¯Ù†"
  },
  {
    noun: {w: "help", fa: "Ú©Ù…Ú©", pr: "Ù‡ÙÙ„Ù¾"},
    verb: {w: "ask", fa: "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø±Ø¯Ù†", pr: "Ø§Ø³Ú©"},
    chunk: "ask for help",
    chunkFa: "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ù…Ú©"
  },
  {
    noun: {w: "break", fa: "Ø§Ø³ØªØ±Ø§Ø­Øª", pr: "Ø¨Ø±ÛŒÚ©"},
    verb: {w: "take", fa: "Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù†", pr: "ØªÙÛŒÚ©"},
    chunk: "take break",
    chunkFa: "Ø§Ø³ØªØ±Ø§Ø­Øª Ú©ÙˆØªØ§Ù‡"
  },
  {
    noun: {w: "task", fa: "Ú©Ø§Ø±", pr: "ØªØ³Ú©"},
    verb: {w: "complete", fa: "Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù†", pr: "Ú©Ø§Ù…Ù¾Ù„ÛŒØª"},
    chunk: "complete task",
    chunkFa: "Ø§Ù†Ø¬Ø§Ù… ÛŒÚ© Ú©Ø§Ø±"
  },
  {
    noun: {w: "lesson", fa: "Ø¯Ø±Ø³", pr: "Ù„Ø³Ù†"},
    verb: {w: "prepare", fa: "Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ø±Ø¯Ù†", pr: "Ù¾Ø±ÛŒÙ¾ÛŒØ±"},
    chunk: "prepare lesson",
    chunkFa: "Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ø±Ø¯Ù† Ø¯Ø±Ø³"
  }
]
};

/* ================= GAME CLASS ================= */
class Game{
  constructor(){
    this.index=0;
    this.phase=0;
    this.selected=[];
    this.checked=false;
    this.score=0;

    this.el={
      stage:document.getElementById("stage"),
      word:document.getElementById("targetWord"),
      answer:document.getElementById("answerBox"),
      letters:document.getElementById("lettersBox"),
      info:document.getElementById("info"),
      next:document.getElementById("nextBtn"),
      score:document.getElementById("score"),
      progress:document.getElementById("progressBar"),
      overlay:document.getElementById("resultOverlay"),
      rIcon:document.getElementById("resultIcon"),
      rTitle:document.getElementById("resultTitle"),
      rDetail:document.getElementById("resultDetail"),
      rScore:document.getElementById("resultScore")
    };

    this.load();
  }

  shuffle(a){ return a.sort(()=>Math.random()-0.5); }

  updateProgress(){
    const total=data.pairs.length * 3;
    const step=this.index*3 + this.phase + (this.checked?1:0);
    this.el.progress.style.width=(step/total)*100+"%";
  }

  load(){
    this.selected=[];
    this.checked=false;
    this.el.answer.innerHTML="";
    this.el.letters.innerHTML="";
    this.el.info.innerHTML="";
    this.el.next.classList.remove("active");
    this.updateProgress();

    if(this.index>=data.pairs.length){
      document.querySelector(".container").innerHTML=
      `<h2>Game Finished</h2>
       <div style="text-align:center;margin-top:20px;font-size:18px">
       Final Score: ${this.score}
       </div>`;
      return;
    }

    const pair=data.pairs[this.index];
    const stageName=data.stages[this.phase];

    const stageInfo={
      noun:{ text:pair.noun.w, type:"Ø§Ø³Ù…", fa:pair.noun.fa, pr:pair.noun.pr },
      verb:{ text:pair.verb.w, type:"ÙØ¹Ù„", fa:pair.verb.fa, pr:pair.verb.pr },
      chunk:{ text:pair.chunk, type:"ØªØ±Ú©ÛŒØ¨", fa:pair.chunkFa, pr:"" }
    }[stageName];

    this.currentStage=stageInfo;
    this.correct=stageInfo.text;

    this.el.stage.innerText=`Ù…Ø±Ø­Ù„Ù‡ ${this.phase+1} â€” ${stageInfo.type}`;
    this.el.word.innerText=this.correct;

    this.shuffle(this.correct.split("")).forEach(l=>{
      const d=document.createElement("div");
      d.className="letter";
      d.innerText=l;
      d.onclick=()=>this.pick(d,l);
      this.el.letters.appendChild(d);
    });
  }

  pick(el,l){
    if(this.checked) return;
    el.style.opacity="0";
    el.style.pointerEvents="none";
    this.selected.push(l);

    const d=document.createElement("div");
    d.className="letter";
    d.innerText=l;
    d.onclick=()=>{
      if(this.checked) return;
      this.el.answer.removeChild(d);
      const idx=this.selected.indexOf(l);
      if(idx>-1) this.selected.splice(idx,1);
      el.style.opacity="1";
      el.style.pointerEvents="auto";
    };
    this.el.answer.appendChild(d);

    if(this.selected.length === this.correct.length){
      setTimeout(()=>this.check(),200);
    }
  }

  showResultCard(isCorrect, delta){
    const st=this.currentStage;

    this.el.rIcon.textContent = isCorrect ? "âœ…" : "âŒ";
    this.el.rTitle.textContent = isCorrect ? "Ø¢ÙØ±ÛŒÙ†! Ø¯Ø±Ø³Øª Ø¬ÙˆØ§Ø¨ Ø¯Ø§Ø¯ÛŒ" : "Ø§ÛŒÙ† ÛŒÚ©ÛŒ Ø§Ø´ØªØ¨Ø§Ù‡ Ø´Ø¯";

    let detail=`Ù…Ø¹Ù†ÛŒ: ${st.fa}<br>`;
    if(st.pr) detail+=`ØªÙ„ÙØ¸: ${st.pr}<br>`;
    detail+=`Ù†ÙˆØ¹: ${st.type}`;

    this.el.rDetail.innerHTML=detail;
    this.el.rScore.textContent = (delta>0 ? "+"+delta : delta) + " Ø§Ù…ØªÛŒØ§Ø²";

    this.el.overlay.classList.add("show");
  }

  check(){
    if(this.checked) return;
    const user=this.selected.join("");
    this.checked=true;

    const stageName=data.stages[this.phase];
    let delta=0;

    if(user===this.correct){
      delta=data.score[stageName];
      this.score+=delta;
      this.showResultCard(true, delta);
    }else{
      delta=-1;
      this.score+=delta;
      this.showResultCard(false, delta);
    }

    this.el.score.innerText=this.score;
    this.el.next.classList.add("active");
    this.updateProgress();
  }

  next(){
    this.el.overlay.classList.remove("show");
    this.phase++;
    if(this.phase>2){
      this.phase=0;
      this.index++;
    }
    this.load();
  }
}

/* ================= INIT ================= */
const game=new Game();
document.getElementById("modalNext").onclick=()=>game.next();

/* ================= THEME SWITCH ================= */
const themeBtn=document.getElementById("themeBtn");
const logoToggle=document.getElementById("logoToggle");

function applyTheme(t){
  document.body.className=t;
  localStorage.setItem("theme",t);
  themeBtn.textContent = t==="dark" ? "ğŸŒ™" : "â˜€";
}

applyTheme(localStorage.getItem("theme") || "dark");

function toggleTheme(){
  const t=document.body.classList.contains("dark") ? "light" : "dark";
  applyTheme(t);
}

themeBtn.onclick=toggleTheme;
logoToggle.onclick=toggleTheme;
</script>

</body>
</html>
